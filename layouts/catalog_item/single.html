{{ define "main" }}
<main class="view pb posr bg-light">
  <img class="bg-light__img posa pointer db" src="/img/view-bg.svg" alt="" />
  <div class="container index">
    {{ partial "breadcrumbs.html" . }}
    <div class="view-items">
      <div class="view-item index">
        <div class="df jcsb index">

          <div class="single-radio-header">
            <div class="single-radio-logo-wrap">
              <img class="single-radio-logo" src="{{ .Params.logo }}" alt="{{ .Title }}" title="{{ .Title }}" />
            </div>
            <!--<div class="single-radio-title-wrap">
          <h1 class="single-radio-title">{{ .Title }}</h1>
          <div class="single-radio-meta">
            <a class="single-radio-link" href="{{ .Params.website_url }}" target="_blank" rel="noopener">{{ .Params.website_url }}</a>
            <div class="single-radio-rating" aria-label="Rating {{ .Params.rating }} out of 5">
              <span class="star" aria-hidden="true">â˜…</span><span>{{ .Params.rating }}</span>
            </div>
          </div>
        </div>-->
          </div>
          <div class="radio-info">
            <h2 class="title center df aifs stream-title index">{{ .Title }}</h2>
            <p class="radio-description">
              {{ .Params.description }}
            </p>
            <div class="radio-meta">
              <div class="meta-item">
                
                <span>

                  <a href="{{ .Params.website_url }}" target="_blank" style="color: #4f835b;">
                    {{ .Params.website_url }}</a></span>
              </div>
              <div class="meta-item">
                <i class="fas fa-calendar-alt"></i>
                <span>{{ T "catalog_created" }}: {{ .Params.created }}</span>
              </div>
            </div>
          </div>
          <!--
      <div class="single-radio-body">
        <div class="single-radio-main">
          <div class="single-radio-description">
            {{ .Content }}
          </div>

          <h3>Listen Live</h3>
          <a href="{{ .Params.listen_url }}" class="listen-link" target="_blank" rel="noopener">Listen Now</a>
          <div class="single-radio-player">
            <audio controls>
              <source src="{{ .Params.listen_url }}" type="audio/mpeg">
              Your browser does not support the audio element.
            </audio>
          </div>
        </div>

        <div class="single-radio-sidebar">
          <div class="sidebar-block">
            <h4>Details</h4>
            <ul>
              <li><strong>Country:</strong> {{ .Params.country_name }}</li>
              {{ with .Params.region_name }}<li><strong>Region:</strong> {{ . }}</li>{{ end }}
              {{ with .Params.city_name }}<li><strong>City:</strong> {{ . }}</li>{{ end }}
              <li><strong>Added:</strong> {{ .Date.Format "January 2, 2006" }}</li>
            </ul>
          </div>

          <div class="sidebar-block">
            <h4>Genres</h4>
            <div class="catalog-card-tags">
              {{ range .Params.genres }}
                <a href="{{ "/catalog/genres/" | relLangURL }}{{ . | urlize }}/">#{{ . }}</a>
              {{ end }}
            </div>
          </div>

          <div class="sidebar-block">
            <h4>Rate this station</h4>
            <form class="rating-form">
              <fieldset class="rating">
                <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5 stars"></label>
                <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars"></label>
                <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars"></label>
                <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars"></label>
                <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 star"></label>
              </fieldset>
              <button type="submit">Vote</button>
            </form>
          </div>
        -->

        </div>
                
          <div class="df jcsb index">
            <h4>Location:  </h4>
            <div class="df">
              <img src="/catalog/flags/{{ .Params.country_code }}.png" alt="{{ .Params.country_name }}"  title="{{ .Params.country_name }}" />
              {{ .Params.country_name }} > 
              {{ if .Params.region_name }}
              {{ .Params.region_name }} >
              {{ end }}
              {{ if .Params.city_name }}
              {{ .Params.city_name }}
              {{ end }}
              </div>
          </div>

          <div class="df jcsb index">
            <h4>Language:  </h4>
            <div class="df">
              {{ range .Params.languages }}
                  <span>{{ . }}</span>
              {{ end }}              
          </div>

          <div class="df jcsb index">
            <h4>Genres:  </h4>
            <div class="df">
              {{ range .Params.genres }}
                  <span>#{{ . }}</span>
              {{ end }}              
          </div>

          <div class="df jcsb index">
            <h4>Links:  </h4>
            <div class="df">
              {{ range .Params.streams }}
                  <span>{{ .bitrate }}kbps {{ .audio_format }} {{ .stream_url }}</span>
                  <a href="/listen/stream_{{ .id }}.m3u" download>M3U</a>
                  <a href="/listen/stream_{{ .id }}.pls" download>PLS</a>
              {{ end }}              
          </div>

      </div>
    </div>
  </div>
  </div>
  </div>

            <div class="voting-bar" id="radio-voting-bar" data-server-url="{{ $.Site.BaseURL }}" data-radio-id="{{ $.Params.id }}">
              {{ range $i := seq 1 10 }}
                <div class="voting-item">
                  <div class="voting-face" data-score="{{ $i }}">
                    <svg width="32" height="32" viewBox="0 0 40 40">
                      {{ $green := div (mul (sub $i 1) 215) 9 }}
                      {{ $color := printf "rgb(255, %d, 0)" $green }}
                      <circle class="face-circle" cx="20" cy="20" r="18" fill="{{ $color }}" stroke="#ccc" stroke-width="2" />
                      <!-- Speaker cone -->
                      <rect x="12" y="16" width="4" height="8" fill="#333" />
                      <polygon points="16,16 22,12 22,28 16,24" fill="#333" />
                      <!-- Sound waves based on volume level -->
                      {{ if ge $i 3 }}
                      <path d="M 24 18 Q 26 16 26 20 Q 26 24 24 22" stroke="#333" stroke-width="1.5" fill="none" />
                      {{ end }}
                      {{ if ge $i 6 }}
                      <path d="M 26 16 Q 29 14 29 20 Q 29 26 26 24" stroke="#333" stroke-width="1.5" fill="none" />
                      {{ end }}
                      {{ if ge $i 9 }}
                      <path d="M 28 14 Q 32 12 32 20 Q 32 28 28 26" stroke="#333" stroke-width="1.5" fill="none" />
                      {{ end }}
                    </svg>
                  </div>
                  <div class="voting-score">{{ $i }}</div>
                </div>
              {{ end }}
            </div>
            <div id="vote-alert" class="vote-alert" style="display: none;"></div>
            <script>
              document.addEventListener('DOMContentLoaded', function() {
                const votingBar = document.getElementById('radio-voting-bar');
                const votingItems = document.querySelectorAll('.voting-item');
                const originalColors = new Map();
                let hasVoted = false;
                const serverUrl = votingBar.getAttribute('data-server-url');
                const radioId = parseInt(votingBar.getAttribute('data-radio-id'));


                function showAlert(message, type) {
                  const alert = document.getElementById('vote-alert');
                  alert.textContent = message;
                  alert.className = `vote-alert ${type}`;
                  alert.style.display = 'block';
                  
                  setTimeout(() => {
                    alert.style.display = 'none';
                  }, 5000);
                }

                function disableVoting() {
                  hasVoted = true;
                  votingItems.forEach(item => {
                    const face = item.querySelector('.voting-face');
                    face.classList.add('disabled');
                  });
                }

                async function submitVote(radioId, score, serverUrl) {
                  console.log("serverUrl: ", serverUrl )
                  try {
                    const response = await fetch(`${serverUrl}/api/v1/catalog/vote`, {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({
                        radio_id: radioId,
                        score: score
                      })
                    });

                    if (response.ok) {
                      showAlert('Vote submitted successfully!', 'success');
                      disableVoting();
                    } else if (response.status === 403) {
                      showAlert('You have already voted for this radio station.', 'error');
                      disableVoting();
                    } else {
                      showAlert('Error submitting vote. Please try again.', 'error');
                    }
                  } catch (error) {
                    showAlert('Network error. Please check your connection.', 'error');
                  }
                }

                votingItems.forEach(item => {
                  const face = item.querySelector('.voting-face');
                  const circle = face.querySelector('.face-circle');
                  const score = parseInt(face.getAttribute('data-score'), 10);
                  originalColors.set(score, circle.getAttribute('fill'));

                  // Click event for voting
                  item.addEventListener('click', () => {
                    if (!hasVoted && !face.classList.contains('disabled')) {
                      submitVote(radioId, score, serverUrl);
                    }
                  });

                  // Hover effects
                  item.addEventListener('mouseover', () => {
                    if (hasVoted) return;
                    
                    const hoveredScore = score;
                    votingItems.forEach(innerItem => {
                      const innerFace = innerItem.querySelector('.voting-face');
                      const innerCircle = innerFace.querySelector('.face-circle');
                      const innerScore = parseInt(innerFace.getAttribute('data-score'), 10);

                      if (innerScore <= hoveredScore) {
                        const green = Math.round(255 * (innerScore - 1) / 9);
                        const red = 255 - green;
                        const highlightColor = `rgb(${red}, ${green}, 0)`;
                        innerCircle.setAttribute('fill', highlightColor);
                      } else {
                        innerCircle.setAttribute('fill', originalColors.get(innerScore));
                      }
                    });
                  });

                  item.addEventListener('mouseout', () => {
                    if (hasVoted) return;
                    
                    votingItems.forEach(innerItem => {
                      const innerFace = innerItem.querySelector('.voting-face');
                      const innerCircle = innerFace.querySelector('.face-circle');
                      const innerScore = parseInt(innerFace.getAttribute('data-score'), 10);
                      innerCircle.setAttribute('fill', originalColors.get(innerScore));
                    });
                  });
                });
              });
            </script>

</main>
{{ end }}