{{ define "main" }}
<link rel="stylesheet" href="/css/catalog-spa.css">
<main class="doc pb posr">
  <img class="bg-light__img posa pointer db" src="/img/view-bg.svg" alt="" />
  <div class="container index doc-container">
    {{ partial "breadcrumbs.html" . }}
    <div>
      {{ $paginator := .Paginate (where .Pages "Type" "catalog_item") 30 }}
      
      {{/* Load filter data based on language */}}
      {{ $genres := slice }}
      {{ $countries := slice }}
      {{ $regions := slice }}
      {{ $cities := slice }}
      {{ $languages := slice }}
      
      {{ if eq .Lang "ru" }}
        {{ $genres = .Site.Data.genres_ru }}
        {{ $countries = .Site.Data.countries_ru }}
        {{ $regions = .Site.Data.regions_ru }}
        {{ $cities = .Site.Data.cities_ru }}
        {{ $languages = .Site.Data.languages_ru }}
      {{ else }}
        {{ $genres = .Site.Data.genres_eng }}
        {{ $countries = .Site.Data.countries_eng }}
        {{ $regions = .Site.Data.regions_eng }}
        {{ $cities = .Site.Data.cities_eng }}
        {{ $languages = .Site.Data.languages_eng }}
      {{ end }}

      {{/* SPA Controls */}}
      <div id="catalog-spa-controls" class="catalog-spa-controls" data-lang="{{ .Lang }}">
        <div class="catalog-controls-row">
          <div class="catalog-search-wrapper">
            <input 
              type="text" 
              id="catalog-search" 
              class="catalog-search-input" 
              placeholder="{{ if eq .Lang "ru" }}–ü–æ–∏—Å–∫ —Ä–∞–¥–∏–æ—Å—Ç–∞–Ω—Ü–∏–π...{{ else }}Search radio stations...{{ end }}"
              autocomplete="off"
            />
            <span class="search-icon">üîç</span>
          </div>

          <div class="catalog-sort-wrapper">
            <label for="catalog-sort">{{ if eq .Lang "ru" }}–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞{{ else }}Sort by{{ end }}:</label>
            <select id="catalog-sort" class="catalog-sort-select">
              <option value="rating" selected>{{ if eq .Lang "ru" }}–†–µ–π—Ç–∏–Ω–≥{{ else }}Rating{{ end }}</option>
              <option value="votes">{{ if eq .Lang "ru" }}–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤{{ else }}Number of votes{{ end }}</option>
              <option value="created">{{ if eq .Lang "ru" }}–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è{{ else }}Date added{{ end }}</option>
            </select>
          </div>
        </div>

        <div class="catalog-filters-row">
          <div class="catalog-filter-wrapper">
            <label for="filter-genre">{{ if eq .Lang "ru" }}–ñ–∞–Ω—Ä{{ else }}Genre{{ end }}:</label>
            <select id="filter-genre" class="catalog-filter-select">
              <option value="">{{ if eq .Lang "ru" }}–í—Å–µ{{ else }}All{{ end }}</option>
              {{ range $genres }}
                <option value="{{ . }}">{{ . }}</option>
              {{ end }}
            </select>
          </div>

          <div class="catalog-filter-wrapper">
            <label for="filter-country">{{ if eq .Lang "ru" }}–°—Ç—Ä–∞–Ω–∞{{ else }}Country{{ end }}:</label>
            <select id="filter-country" class="catalog-filter-select">
              <option value="">{{ if eq .Lang "ru" }}–í—Å–µ{{ else }}All{{ end }}</option>
              {{ range $countries }}
                <option value="{{ . }}">{{ . }}</option>
              {{ end }}
            </select>
          </div>

          <div class="catalog-filter-wrapper">
            <label for="filter-region">{{ if eq .Lang "ru" }}–†–µ–≥–∏–æ–Ω{{ else }}Region{{ end }}:</label>
            <select id="filter-region" class="catalog-filter-select">
              <option value="">{{ if eq .Lang "ru" }}–í—Å–µ{{ else }}All{{ end }}</option>
              {{ range $regions }}
                <option value="{{ . }}">{{ . }}</option>
              {{ end }}
            </select>
          </div>

          <div class="catalog-filter-wrapper">
            <label for="filter-city">{{ if eq .Lang "ru" }}–ì–æ—Ä–æ–¥{{ else }}City{{ end }}:</label>
            <select id="filter-city" class="catalog-filter-select">
              <option value="">{{ if eq .Lang "ru" }}–í—Å–µ{{ else }}All{{ end }}</option>
              {{ range $cities }}
                <option value="{{ . }}">{{ . }}</option>
              {{ end }}
            </select>
          </div>

          <div class="catalog-filter-wrapper">
            <label for="filter-language">{{ if eq .Lang "ru" }}–Ø–∑—ã–∫{{ else }}Language{{ end }}:</label>
            <select id="filter-language" class="catalog-filter-select">
              <option value="">{{ if eq .Lang "ru" }}–í—Å–µ{{ else }}All{{ end }}</option>
              {{ range $languages }}
                <option value="{{ . }}">{{ . }}</option>
              {{ end }}
            </select>
          </div>

          <button id="reset-filters" class="catalog-reset-btn">
            {{ if eq .Lang "ru" }}–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã{{ else }}Reset filters{{ end }}
          </button>
        </div>

        <div id="catalog-loading" class="catalog-loading" style="display: none;">
          <div class="spinner"></div>
          <span>{{ if eq .Lang "ru" }}–ó–∞–≥—Ä—É–∑–∫–∞...{{ else }}Loading...{{ end }}</span>
        </div>
      </div>

      <div class="catalog-grid">
        {{ range $paginator.Pages }}
        <div class="catalog-card">
          <img class="catalog-card-flag" src="/catalog/flags/{{ .Params.country_code }}.png" alt="{{ .Params.country_name }}"  title="{{ .Params.country_name }}" />
          <div class="catalog-card__inner">
            <div class="catalog-thumb-wrap" {{ if .Params.default_stream }}data-stream-url="{{.Params.default_stream}}"{{ end }}>
              <a href="{{ .RelPermalink }}"
                ><img
                  class="catalog-thumb"
                  src="{{ .Params.logo }}"
                  alt="{{ .Title }}"
                  title="{{ .Title }}"
              /></a>
            </div>
            <div class="catalog-card-title" title="{{ .Title }}">
              <a href="{{ .RelPermalink }}">{{ .Title }}</a>
            </div>
            <div class="catalog-card-meta">
              <a
                class="catalog-card-link"
                href="{{ .Params.website_url }}"
                target="_blank"
                rel="noopener"
                >{{ .Params.website_url }}</a
              >
              <div class="catalog-card-rating" aria-label="Rating {{ .Params.rating }} out of 10">
                <span class="star" aria-hidden="true">‚òÖ</span><span>{{ .Params.rating }}</span>
              </div>
              
            </div>
            <div class="catalog-card-tags">
              {{ range .Params.genres }}
                  <span>#{{ . }}</span>
              {{ end }}              
            </div>
          </div>
        </div>
        {{ end }}
      </div>
      {{ template "_internal/pagination.html" . }}
    </div>
  </div>
</main>
<script src="/js/catalog-spa.js"></script>
<script src="/js/catalog.js"></script>
{{ end }}
